pipeline {
    agent any

    tools{
        maven 'maven'
        dockerTool 'docker'
    }

    stages{

        stage('Checkout code'){
            steps{
                git branch: 'master', url: 'https://github.com/AdityaZaware1/CommerceHub'
            }
        }

        stage("Build Maven"){
            steps{
                dir('Branch-Service'){
                    sh 'mvn clean install -DskipTests'
                }

            }
        }
        stage("Build Docker Image"){
            steps{
                dir('Branch-Service'){
                    sh 'docker build -t adityazaware/branchservice .'
                }
            }
        }

        stage('Push to Dokcer hub'){
            steps{
                script{
                    withCredentials([string(credentialsId: 'dockerhub-pwd', variable: 'DOCKERHUB_PWD')]) {
                        sh """
                            docker login -u adityazaware -p $DOCKERHUB_PWD
                            docker push adityazaware/branchservice
                        """
                    }
                }
            }
        }
    }
}